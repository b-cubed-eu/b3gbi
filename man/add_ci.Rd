% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/add_ci.R
\name{add_ci}
\alias{add_ci}
\title{Add Confidence Intervals to an Indicator Object}
\usage{
add_ci(
  indicator,
  num_bootstrap = 1000,
  bootstrap_level = c("cube", "indicator"),
  ci_type = c("norm", "basic", "perc", "bca", "none"),
  trans = function(t) t,
  inv_trans = function(t) t,
  confidence_level = 0.95,
  overwrite = TRUE,
  boot_args = list(),
  ci_args = list(),
  ...
)
}
\arguments{
\item{indicator}{An object of class \code{indicator_ts} to which confidence
intervals should be added.}

\item{num_bootstrap}{(Optional) Number of bootstrap replicates to perform.
(Default: 1000)}

\item{bootstrap_level}{(Optional) Level at which to perform bootstrapping:
\itemize{
\item \code{cube} (default): Bootstrapping is done by resampling the
occurrence records in the cube. This is mathematically more robust as it
captures the underlying sampling uncertainty.
\item \code{indicator}: Bootstrapping is done by resampling indicator
values. This is faster for large cubes but less robust.
}}

\item{ci_type}{(Optional) Type of bootstrap confidence intervals to
calculate. (Default: \code{"norm"}). Supported options are:
\itemize{
\item \code{norm}: Normal approximation intervals.
\item \code{basic}: Basic bootstrap intervals.
\item \code{perc}: Percentile intervals.
\item \code{bca}: Bias-corrected and accelerated intervals.
\item \code{none}: No confidence intervals calculated.
}}

\item{trans}{(Optional) A function for transforming the indicator values
before calculating confidence intervals (e.g., \code{log}).
(Default: identity function)}

\item{inv_trans}{(Optional) The inverse of the transformation function
\code{trans} (e.g., \code{exp}). Used to back-transform the intervals
to the original scale. (Default: identity function)}

\item{confidence_level}{(Optional) The confidence level for the calculated
intervals (e.g., 0.95 for 95\% CIs). (Default: 0.95)}

\item{overwrite}{(Optional) Logical. If the indicator already contains
confidence intervals (\code{ll} and \code{ul} columns), should they
be replaced? (Default: TRUE)}

\item{boot_args}{(Optional) Named list of additional arguments passed to
\code{dubicube::bootstrap_cube()}. (Default: \code{list()})}

\item{ci_args}{(Optional) Named list of additional arguments passed to
\code{dubicube::calculate_bootstrap_ci()}. (Default: \code{list()})}

\item{...}{Additional arguments passed to the underlying functions.}
}
\value{
An updated object of class \code{indicator_ts} containing the
original data with the following additional columns:
\itemize{
\item \code{ll}: Lower limit of the confidence interval.
\item \code{ul}: Upper limit of the confidence interval.
\item \code{est_boot}: The bootstrap estimate of the indicator value.
\item \code{se_boot}: The bootstrap standard error.
\item \code{bias_boot}: The bootstrap estimate of bias.
\item \code{int_type}: The type of interval calculated (e.g., 'perc').
\item \code{conf}: The confidence level used.
}
}
\description{
This function calculates bootstrap confidence intervals for an existing
\code{indicator_ts} object. It supports both cube-level bootstrapping (resampling
occurrence records) and indicator-level bootstrapping (resampling
calculated values), allowing for advanced transformations during the
CI calculation process.
}
\details{
The function acts as a bridge to the \code{dubicube} package for statistical
heavy lifting.
\subsection{Indicator-specific defaults}{

Depending on the indicator, default settings are internally applied when
calculating bootstrap confidence intervals. These defaults control whether
bootstrapping is performed per group, which transformation is used, and
whether bias correction is disabled.

The following defaults are used unless explicitly overridden via
\code{trans}, \code{inv_trans}, \code{boot_args}, or \code{ci_args}:
\itemize{
\item \strong{\code{total_occ}}
\itemize{
\item Group-specific bootstrapping: \strong{yes}
\item Transformation: \strong{none (identity)}
\item Bias correction: \strong{disabled} (\code{no_bias = TRUE})
}
\item \strong{\code{spec_occ}, \code{spec_range}}
\itemize{
\item Group-specific bootstrapping: \strong{yes}
\item Transformation: \strong{none (identity)}
\item Bias correction: enabled
}
\item \strong{\code{pielou_evenness}, \code{williams_evenness}}
\itemize{
\item Group-specific bootstrapping: \strong{no}
\item Transformation: \strong{logit}
\item Inverse transformation: \strong{inverse logit}
\item Bias correction: enabled
}
\item \strong{\code{occ_density}, \code{ab_rarity}, \code{area_rarity}, \code{newness}}
\itemize{
\item Group-specific bootstrapping: \strong{no}
\item Transformation: \strong{none (identity)}
\item Bias correction: enabled
}
}

Group-specific bootstrapping means that resampling is performed within each
group (e.g., species or year), which is required for indicators that are
inherently group-based. This in contrast to whole-cube bootstrapping
where resampling is performed across the whole dataset; applicable for
indicators that combine information across groups

Transformations are applied prior to confidence interval calculation and
inverted afterwards to return intervals on the original scale.
}

\subsection{Indicators outside scope of this function}{

For certain indicators, confidence intervals cannot be
added post-hoc as they are calculated internally via the \code{iNext} package, or
if they are not relevant. In such cases, a warning is issued and the
original object is returned. The following indicators cannot have confidence
intervals added via \code{add_ci()}:
\itemize{
\item \code{hill0}, \code{hill1}, \code{hill2} (calculated internally)
\item \code{obs_richness}
\item \code{cum_richness}
\item \code{occ_turnover}
\item \code{tax_distinct}
}
}
}
\seealso{
\code{\link[dubicube:bootstrap_cube]{dubicube::bootstrap_cube()}}, \code{\link[dubicube:calculate_bootstrap_ci]{dubicube::calculate_bootstrap_ci()}}
}
